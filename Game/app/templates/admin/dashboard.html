{# app/templates/admin/dashboard.html #}
{% extends "base.html" %}

{% block content %}
    <h1>Admin Dashboard</h1>

    <div class="dashboard-stats">
        <div class="stat-box">
            <h4>Total Users</h4>
            <p>{{ user_count }}</p>
        </div>
        <div class="stat-box">
            <h4>Total Challenges</h4>
            <p>{{ challenge_count }}</p>
        </div>
        <div class="stat-box">
            <h4>Total Products</h4>
            <p>{{ product_count }}</p>
        </div>
        <div class="stat-box">
            <h4>Total Purchases</h4>
            <p>{{ purchase_count }}</p>
        </div>
    </div>

    <div class="recent-activity">
        <h3>Recent Solved Challenges</h3>
        {% if recent_solves %}
            <ul>
                {% for solve in recent_solves %}
                    <li>
                        <strong>{{ solve.user.username }}</strong> solved challenge "<a href="{{ url_for('admin.view_challenge', challenge_id=solve.challenge.id) }}">{{ solve.challenge.title }}</a>" ({{ solve.challenge.difficulty }}) at {{ solve.solution_time.strftime('%Y-%m-%d %H:%M') }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No challenges have been solved yet.</p>
        {% endif %}
    </div>

    <div class="recent-registrations">
        <h3>Recent User Registrations</h3>
        {% if recent_users %}
            <ul>
                {% for user in recent_users %}
                    <li>
                        User <strong>{{ user.username }}</strong> ({{ user.role }}) registered on {{ user.date_registered.strftime('%Y-%m-%d %H:%M') }}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No users have registered yet.</p>
        {% endif %}
    </div>

    <div class="admin-links">
        <h3>Admin Actions</h3>
        <p>
            <a href="{{ url_for('admin.create_challenge') }}" class="btn btn-success">Create New Challenge</a>
            <a href="{{ url_for('admin.manage_challenges') }}" class="btn btn-primary">Manage Challenges</a>
            <a href="{{ url_for('admin.manage_users') }}" class="btn btn-primary">Manage Users</a>
            <a href="{{ url_for('admin.statistics') }}" class="btn btn-info">View Statistics</a>
        </p>
    </div>

{% endblock %}
